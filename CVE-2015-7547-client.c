/* Copyright 2016 Google Inc
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
*/

#include <sys/types.h>
#include <sys/socket.h>
#include <netdb.h>
#include <err.h>
#include <stdio.h>
#include <string.h>
#include <arpa/inet.h>

int
main(void)
{
	struct addrinfo hints, *res, *aip;
	int r;
	const char* addr;
	struct sockaddr_in *sinp; 
	char	abuf[INET_ADDRSTRLEN];  

	memset(&hints, 0, sizeof(hints));
	hints.ai_socktype = SOCK_STREAM;
do{
	printf("test begin\n");
	if ((r = getaddrinfo("baidu.com", "22",
	    &hints, &res)) != 0){
		printf( "getaddrinfo: %s\n", gai_strerror(r));
		sleep(1);
		continue;
	}
	printf("start print out\n");
	for (aip = res; aip != NULL; aip = aip->ai_next) {
		sinp = (struct sockaddr_in *)(aip->ai_addr);
		if(sinp == NULL){
			printf("resolved addr is null\n");
			return 0;
		}
		printf("ip is:%ux\n",sinp->sin_addr.s_addr);
		fflush(stdout);
		addr = inet_ntop(AF_INET, &(sinp->sin_addr), abuf,INET_ADDRSTRLEN);  
		printf("addr is:%ux\n",addr);
		printf(" address %s\n", addr?addr:"unknown");  
	}
	
	printf("%s",addr);
	sleep(3);
}while(3);
	return 0;
}
